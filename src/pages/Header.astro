---
import { translations } from "../translations/Translations.js";
---

<header
    class="fixed top-0 left-0 w-full z-50 bg-theme-bg/90 backdrop-blur-md border-b border-theme-border transition-all duration-300"
>
    <div
        class="max-w-7xl mx-auto px-6 md:px-12 h-24 flex items-center justify-between"
    >
        <a href="/" class="z-50 group flex-shrink-0">
            <span
                class="font-montserrat font-medium text-[22px] md:text-[25px] leading-[30px] tracking-tight text-theme-text transition-opacity hover:opacity-80"
            >
                marcosgonzalez.dev
            </span>
        </a>

        <nav
            class="hidden md:flex items-center gap-1 bg-theme-card p-1 rounded-full border border-theme-border"
        >
            <button
                id="btn-dev"
                class="mode-btn px-5 py-2 rounded-full text-xs font-montserrat font-bold tracking-wide transition-all duration-300"
                onclick="switchMode('dev')"
                data-lang="nav.dev"
            >
                DESARROLLO
            </button>
            <button
                id="btn-sec"
                class="mode-btn px-5 py-2 rounded-full text-xs font-montserrat font-bold tracking-wide transition-all duration-300"
                onclick="switchMode('sec')"
                data-lang="nav.sec"
            >
                CIBERSEGURIDAD
            </button>
        </nav>

        <div class="hidden md:flex items-center gap-6">
            <div
                class="flex items-center gap-6 border-r border-theme-border pr-6"
            >
                <a
                    href="/Blog"
                    class="relative group font-montserrat font-medium text-sm text-theme-muted hover:text-theme-text transition-colors flex items-center gap-2"
                >
                    <span data-lang="nav.blog">blog</span>
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="18"
                        height="18"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        ><path
                            d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
                        ></path><polyline points="14 2 14 8 20 8"
                        ></polyline><line x1="16" y1="13" x2="8" y2="13"
                        ></line><line x1="16" y1="17" x2="8" y2="17"
                        ></line><polyline points="10 9 9 9 8 9"></polyline></svg
                    >
                    <span
                        class="absolute -bottom-1 left-0 w-0 h-[1px] bg-theme-text transition-all duration-300 ease-out group-hover:w-full"
                    ></span>
                </a>

                <a
                    href="https://github.com/"
                    target="_blank"
                    class="relative group font-montserrat font-medium text-sm text-theme-muted hover:text-theme-text transition-colors flex items-center gap-2"
                >
                    <span>github</span>
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="18"
                        height="18"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        ><path
                            d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"
                        ></path></svg
                    >
                    <span
                        class="absolute -bottom-1 left-0 w-0 h-[1px] bg-theme-text transition-all duration-300 ease-out group-hover:w-full"
                    ></span>
                </a>

                <a
                    href="https://linkedin.com/in/tu-usuario"
                    target="_blank"
                    class="relative group font-montserrat font-medium text-sm text-theme-muted hover:text-theme-text transition-colors flex items-center gap-2"
                >
                    <span>linkedIn</span>
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="18"
                        height="18"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        ><path
                            d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"
                        ></path><rect x="2" y="9" width="4" height="12"
                        ></rect><circle cx="4" cy="4" r="2"></circle></svg
                    >
                    <span
                        class="absolute -bottom-1 left-0 w-0 h-[1px] bg-theme-text transition-all duration-300 ease-out group-hover:w-full"
                    ></span>
                </a>
            </div>

            <div class="flex items-center gap-3">
                <button
                    id="theme-toggle"
                    class="p-2 rounded-full hover:bg-theme-muted/10 text-theme-text transition-colors"
                    aria-label="Toggle Theme"
                >
                    <svg
                        id="icon-sun"
                        class="hidden"
                        xmlns="http://www.w3.org/2000/svg"
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        ><circle cx="12" cy="12" r="5"></circle><path
                            d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"
                        ></path></svg
                    >
                    <svg
                        id="icon-moon"
                        xmlns="http://www.w3.org/2000/svg"
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        ><path
                            d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"
                        ></path></svg
                    >
                </button>

                <button
                    id="lang-toggle"
                    class="w-8 h-8 flex items-center justify-center rounded-full border border-theme-border text-[10px] font-bold font-mono text-theme-text hover:border-theme-text transition-colors"
                >
                    ES
                </button>
            </div>
        </div>

        <button id="menu-toggle" class="md:hidden text-theme-text p-2">
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                ><line x1="3" y1="12" x2="21" y2="12"></line><line
                    x1="3"
                    y1="6"
                    x2="21"
                    y2="6"></line><line x1="3" y1="18" x2="21" y2="18"
                ></line></svg
            >
        </button>
    </div>

    <div
        id="mobile-menu"
        class="fixed inset-0 bg-theme-bg z-40 transform translate-x-full transition-transform duration-300 md:hidden flex flex-col justify-center items-center gap-8"
    >
        <button
            class="absolute top-6 right-6 text-theme-text p-2"
            onclick="closeMenu()"
        >
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width="30"
                height="30"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                ><line x1="18" y1="6" x2="6" y2="18"></line><line
                    x1="6"
                    y1="6"
                    x2="18"
                    y2="18"></line></svg
            >
        </button>

        <div class="flex flex-col gap-4 w-64">
            <button
                class="mobile-link text-xl font-montserrat font-bold text-center p-4 border border-theme-border rounded-lg hover:bg-theme-muted/10 transition-colors"
                onclick="switchMode('dev'); closeMenu()"
                data-i18n="nav.dev"
            >
                DESARROLLO
            </button>
            <button
                class="mobile-link text-xl font-montserrat font-bold text-center p-4 border border-theme-border rounded-lg hover:bg-theme-muted/10 transition-colors"
                onclick="switchMode('sec'); closeMenu()"
                data-i18n="nav.sec"
            >
                CIBERSEGURIDAD
            </button>
        </div>

        <div class="w-16 h-[1px] bg-theme-border my-2"></div>

        <a
            href="/blog"
            class="relative group text-lg font-montserrat text-theme-text flex items-center gap-2"
            onclick="closeMenu()"
        >
            <span data-i18n="nav.blog">blog</span>
            <span
                class="absolute -bottom-1 left-0 w-0 h-[1px] bg-theme-text transition-all duration-300 ease-out group-hover:w-full"
            ></span>
        </a>

        <a
            href="https://github.com/"
            target="_blank"
            class="relative group text-lg font-montserrat text-theme-text flex items-center gap-2"
            onclick="closeMenu()"
        >
            <span>GitHub</span>
            <span
                class="absolute -bottom-1 left-0 w-0 h-[1px] bg-theme-text transition-all duration-300 ease-out group-hover:w-full"
            ></span>
        </a>

        <a
            href="https://linkedin.com/in/tu-usuario"
            target="_blank"
            class="relative group text-lg font-montserrat text-theme-text flex items-center gap-2"
            onclick="closeMenu()"
        >
            <span>LinkedIn</span>
            <span
                class="absolute -bottom-1 left-0 w-0 h-[1px] bg-theme-text transition-all duration-300 ease-out group-hover:w-full"
            ></span>
        </a>
    </div>
</header>

<script is:inline define:vars={{ translations }}>
    // LÓGICA DEL MENÚ MÓVIL (NUEVO)
    const menuToggle = document.getElementById("menu-toggle");
    const mobileMenu = document.getElementById("mobile-menu");

    // Función para abrir/cerrar
    menuToggle?.addEventListener("click", () => {
        if (mobileMenu.classList.contains("translate-x-full")) {
            // Abrir
            mobileMenu.classList.remove("translate-x-full");
        } else {
            // Cerrar
            mobileMenu.classList.add("translate-x-full");
        }
    });

    // Función global para cerrar menú (al pulsar un link)
    window.closeMenu = function () {
        mobileMenu?.classList.add("translate-x-full");
    };

    // LÓGICA DE IDIOMA
    const langToggle = document.getElementById("lang-toggle");
    let currentLang = localStorage.getItem("lang") || "es";

    function updateTexts(lang) {
        // Buscamos elementos con data-lang
        const elements = document.querySelectorAll("[data-lang]");

        elements.forEach((element) => {
            const key = element.getAttribute("data-lang");

            // VALIDACIÓN DE SEGURIDAD 1: ¿Existe el idioma?
            if (!translations[lang]) {
                console.error(
                    `Error crítico: No existe el idioma '${lang}' en el diccionario.`,
                );
                return;
            }

            // VALIDACIÓN DE SEGURIDAD 2: ¿Existe la traducción específica?
            const translationValue = translations[lang][key];

            if (translationValue) {
                // Si existe, la aplicamos
                element.innerHTML = translationValue;
            } else {
                // Si NO existe, NO hacemos nada (así el texto original no desaparece)
                console.warn(
                    `⚠️ Traducción faltante para: "${key}" en idioma: "${lang}". Se mantiene el texto original.`,
                );
            }
        });
    }

    function setLanguage(lang) {
        currentLang = lang;
        localStorage.setItem("lang", lang);
        if (langToggle) langToggle.textContent = lang.toUpperCase();

        // Ejecutamos la actualización de textos
        updateTexts(lang);
    }

    setLanguage(currentLang);

    //Ejecutar otra vez cuando todo el HTML haya cargado
    document.addEventListener("DOMContentLoaded", () => {
        setLanguage(currentLang);
    });

    langToggle?.addEventListener("click", () => {
        const newLang = currentLang === "es" ? "en" : "es";
        setLanguage(newLang);
    });

    // LÓGICA DE TEMA (CLARO / OSCURO)
    const themeToggle = document.getElementById("theme-toggle");
    const iconSun = document.getElementById("icon-sun");
    const iconMoon = document.getElementById("icon-moon");
    const html = document.documentElement;

    function setTheme(isLight) {
        if (isLight) {
            html.setAttribute("data-theme", "light");
            if (iconSun) iconSun.classList.remove("hidden");
            if (iconMoon) iconMoon.classList.add("hidden");
            localStorage.setItem("theme", "light");
        } else {
            html.removeAttribute("data-theme");
            if (iconSun) iconSun.classList.add("hidden");
            if (iconMoon) iconMoon.classList.remove("hidden");
            localStorage.setItem("theme", "dark");
        }
        // Refrescar estilo de botones si la función existe
        const currentMode = localStorage.getItem("mode") || "dev";
        if (typeof window.switchMode === "function")
            window.switchMode(currentMode);
    }

    const savedTheme = localStorage.getItem("theme") === "light";
    setTheme(savedTheme);

    themeToggle?.addEventListener("click", () => {
        const isLight = html.hasAttribute("data-theme");
        setTheme(!isLight);
    });

    // LÓGICA DE MODOS (DEV / SEC)
    window.switchMode = function (mode) {
        const btnDev = document.getElementById("btn-dev");
        const btnSec = document.getElementById("btn-sec");
        const viewDev = document.getElementById("view-dev");
        const viewSec = document.getElementById("view-sec");

        localStorage.setItem("mode", mode);

        if (!btnDev || !btnSec) return;

        if (mode === "dev") {
            btnDev.style.backgroundColor = "var(--color-theme-text)";
            btnDev.style.color = "var(--color-theme-bg)";
            btnDev.style.boxShadow = "0 0 15px rgba(125,125,125,0.3)";

            btnSec.style.backgroundColor = "transparent";
            btnSec.style.color = "var(--color-theme-muted)";
            btnSec.style.boxShadow = "none";

            if (viewDev && viewSec) {
                viewDev.classList.remove("hidden");
                viewDev.style.display = "block";
                viewSec.classList.add("hidden");
                viewSec.style.display = "none";
            }
        } else {
            btnSec.style.backgroundColor = "var(--color-theme-text)";
            btnSec.style.color = "var(--color-theme-bg)";
            btnSec.style.boxShadow = "0 0 15px rgba(125,125,125,0.3)";

            btnDev.style.backgroundColor = "transparent";
            btnDev.style.color = "var(--color-theme-muted)";
            btnDev.style.boxShadow = "none";

            if (viewDev && viewSec) {
                viewSec.classList.remove("hidden");
                viewSec.style.display = "block";
                viewDev.classList.add("hidden");
                viewDev.style.display = "none";
            }
        }

        // Refrescar GSAP
        setTimeout(
            () => window.ScrollTrigger && window.ScrollTrigger.refresh(),
            100,
        );
    };

    document.addEventListener("DOMContentLoaded", () => {
        const savedMode = localStorage.getItem("mode") || "dev";
        window.switchMode(savedMode);
    });
</script>
